"use strict";(self.webpackChunkdzitra=self.webpackChunkdzitra||[]).push([[874],{8874:(R,b,s)=>{s.r(b),s.d(b,{SubscriptionModule:()=>k});var c=s(6895),m=s(3456),D=s(933),l=s(4006),p=s(5938),t=s(4650),S=s(5619),g=s(9602),Z=s(9549),A=s(4144);function M(i,d){1&i&&(t.TgZ(0,"h5",28),t._uU(1,"Add New Subscription"),t.qZA())}function _(i,d){1&i&&(t.TgZ(0,"h5",28),t._uU(1,"Subscription Info"),t.qZA())}function I(i,d){if(1&i&&(t.TgZ(0,"option",29),t._uU(1),t.qZA()),2&i){const e=d.$implicit;t.Q6J("value",e._id),t.xp6(1),t.Oqu(e.planname)}}function v(i,d){if(1&i&&(t.TgZ(0,"option",29),t._uU(1),t.qZA()),2&i){const e=d.$implicit;t.Q6J("value",e._id),t.xp6(1),t.Oqu(e.name)}}function y(i,d){1&i&&(t.TgZ(0,"button",30),t._uU(1,"Add Subscription"),t.qZA())}function T(i,d){1&i&&(t.TgZ(0,"button",30),t._uU(1,"Save"),t.qZA())}function w(i,d){1&i&&(t.TgZ(0,"button",31),t._uU(1,"Close"),t.qZA())}let f=(()=>{class i{constructor(e,a,n,o){this.fb=e,this.http=a,this.dialogRef=n,this.inputdata=o,this.isEditMode=!1}ngOnInit(){this.addsubscriptionForm=this.fb.group({planid:["",l.kI.required],lead_id:["",l.kI.required],startdate:["",l.kI.required],enddate:["",l.kI.required],maxenddate:["",l.kI.required]}),this.inputdata&&null!==this.inputdata&&(this.subscriptionId=this.inputdata.id,this.isEditMode=!0,this.getData()),this.inputdata?.isReadonly&&(this.readonly=!0,this.addsubscriptionForm.disable()),this.getPlans(),this.getLeads()}getData(){this.http.get(`/subscription/${this.subscriptionId}`).subscribe(e=>{if(1==e.status){let a=e.data;this.addsubscriptionForm.patchValue({planid:a.planid,lead_id:a.lead_id});let n=new Date(a.startdate);this.addsubscriptionForm.get("startdate")?.setValue(n);let o=new Date(a.enddate);this.addsubscriptionForm.get("enddate")?.setValue(o);let r=new Date(a.maxenddate);this.addsubscriptionForm.get("maxenddate")?.setValue(r)}})}getPlans(){this.http.get("/plan/all/active/trial").subscribe(e=>{1==e.status&&(this.planList=e.data)})}getLeads(){this.http.get("/lead/all/active").subscribe(e=>{1==e.status&&(this.leadList=e.data)})}onSubmit(e){if(!e.valid)return;let a=e.value;this.subscriptionId?(a._id=this.subscriptionId,this.http.patch("/subscription",a).subscribe(n=>{1==n.status&&this.dialogRef.close(1)})):this.http.post("/subscription",a).subscribe(n=>{1==n.status&&this.dialogRef.close(1)})}editinfo(){this.addsubscriptionForm.enable(),this.isEditMode=!0,this.readonly=!1}calculatedays(e){let a=e.target.value,n=this.planList.filter(q=>q._id==a),o=new Date,r=o.setDate(o.getDate()+n[0].dayscount),u=new Date(r),h=new Date;this.addsubscriptionForm.get("startdate")?.setValue(h),this.addsubscriptionForm.get("enddate")?.setValue(u)}calcdates(e){let a=e.target.value,n=this.addsubscriptionForm.get("planid")?.value,o=this.planList.filter(h=>h._id==n),r=a.setDate(a.getDate()+o[0].dayscount),u=new Date(r);this.addsubscriptionForm.get("enddate")?.setValue(u)}test(){}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(l.qu),t.Y36(S.h),t.Y36(p.so),t.Y36(p.WI))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-add-subscription-modal"]],decls:48,vars:14,consts:[[1,"row"],[1,"dialogue-head","col-md-8"],["mat-dialog-title","",4,"ngIf"],[1,"close-Btns","col-md-4"],[1,"card","close-Card",3,"mat-dialog-close"],["src","../../../../../assets/image/fi_x.png","alt",""],[1,"addform-container"],[3,"formGroup","ngSubmit"],[1,"col-md-6"],["for","planid",1,"dialogue-label"],["formControlName","planid","name","planid",1,"w-100","input-Class",3,"change"],[3,"value",4,"ngFor","ngForOf"],["for","lead_id",1,"dialogue-label"],["formControlName","lead_id","name","lead_id",1,"w-100","input-Class"],["for","startdate",1,"dialogue-label"],["appearance","fill",1,"col-md-12","datepickerInput"],["matInput","","formControlName","startdate","name","startdate","placeholder","MM/DD/YYYY",3,"matDatepicker","dateChange"],["matIconSuffix","",3,"for"],["picker",""],["for","enddate",1,"dialogue-label"],["matInput","","formControlName","enddate","name","enddate","placeholder","MM/DD/YYYY",3,"matDatepicker"],["picker1",""],["for","maxenddate",1,"dialogue-label"],["matInput","","formControlName","maxenddate","name","maxenddate","placeholder","MM/DD/YYYY",3,"matDatepicker"],["picker2",""],[1,"button","col-md-12"],["type","submit","class","createLead-Btns",4,"ngIf"],["type","submit","class","createLead-Btns",3,"mat-dialog-close",4,"ngIf"],["mat-dialog-title",""],[3,"value"],["type","submit",1,"createLead-Btns"],["type","submit",1,"createLead-Btns",3,"mat-dialog-close"]],template:function(e,a){if(1&e&&(t.TgZ(0,"div",0)(1,"div",1),t.YNc(2,M,2,0,"h5",2),t.YNc(3,_,2,0,"h5",2),t.qZA(),t.TgZ(4,"div",3)(5,"div",4),t._UZ(6,"img",5),t.qZA()()(),t.TgZ(7,"div",6)(8,"form",7),t.NdJ("ngSubmit",function(){return a.onSubmit(a.addsubscriptionForm)}),t.TgZ(9,"div",0)(10,"div",8)(11,"label",9),t._uU(12,"Plan"),t.qZA(),t.TgZ(13,"select",10),t.NdJ("change",function(o){return a.calculatedays(o)}),t.YNc(14,I,2,2,"option",11),t.qZA()(),t.TgZ(15,"div",8)(16,"label",12),t._uU(17,"Lead"),t.qZA(),t.TgZ(18,"select",13),t.YNc(19,v,2,2,"option",11),t.qZA()(),t.TgZ(20,"div",8)(21,"label",14),t._uU(22,"Start Date"),t.qZA(),t.TgZ(23,"mat-form-field",15)(24,"input",16),t.NdJ("dateChange",function(o){return a.calcdates(o)}),t.qZA(),t._UZ(25,"mat-datepicker-toggle",17)(26,"mat-datepicker",null,18),t.qZA()(),t.TgZ(28,"div",8)(29,"label",19),t._uU(30,"End Date"),t.qZA(),t.TgZ(31,"mat-form-field",15),t._UZ(32,"input",20)(33,"mat-datepicker-toggle",17)(34,"mat-datepicker",null,21),t.qZA()(),t.TgZ(36,"div",8)(37,"label",22),t._uU(38,"Max End Date"),t.qZA(),t.TgZ(39,"mat-form-field",15),t._UZ(40,"input",23)(41,"mat-datepicker-toggle",17)(42,"mat-datepicker",null,24),t.qZA()()(),t.TgZ(44,"div",25),t.YNc(45,y,2,0,"button",26),t.YNc(46,T,2,0,"button",26),t.YNc(47,w,2,0,"button",27),t.qZA()()()),2&e){const n=t.MAs(27),o=t.MAs(35),r=t.MAs(43);t.xp6(2),t.Q6J("ngIf",!a.isEditMode),t.xp6(1),t.Q6J("ngIf",a.isEditMode),t.xp6(5),t.Q6J("formGroup",a.addsubscriptionForm),t.xp6(6),t.Q6J("ngForOf",a.planList),t.xp6(5),t.Q6J("ngForOf",a.leadList),t.xp6(5),t.Q6J("matDatepicker",n),t.xp6(1),t.Q6J("for",n),t.xp6(7),t.Q6J("matDatepicker",o),t.xp6(1),t.Q6J("for",o),t.xp6(7),t.Q6J("matDatepicker",r),t.xp6(1),t.Q6J("for",r),t.xp6(4),t.Q6J("ngIf",!a.isEditMode&&!a.readonly),t.xp6(1),t.Q6J("ngIf",a.isEditMode&&!a.readonly),t.xp6(1),t.Q6J("ngIf",a.readonly)}},dependencies:[c.sg,c.O5,p.ZT,p.uh,l._Y,l.YN,l.Kr,l.Fj,l.EJ,l.JJ,l.JL,l.sg,l.u,g.Mq,g.hl,g.nW,Z.KE,A.Nt],styles:[".datepickerInput>.mat-form-field-wrapper>.mat-form-field-flex>.mat-form-field-infix{display:contents!important}  .datepickerInput>.mat-form-field-wrapper>.mat-form-field-flex{padding:3px 10px!important}  .datepickerInput>.mat-form-field-wrapper>.mat-form-field-underline{display:none}.mat-datepicker-input[_ngcontent-%COMP%]::placeholder{font-size:13px!important}@media only screen and (max-width: 600px){.mat-form-field[_ngcontent-%COMP%]{display:block!important}}"]}),i})();var C=s(3091),x=s(3575),P=s(8265),N=s(3157),Y=s(2016);const J=[{path:"list",component:(()=>{class i{constructor(e,a,n){this.http=e,this.router=a,this.dialog=n,this.columnDefinition=[],this.tablePaginationSettings={},this.rowData=[],this.tablePaginationSettings.enablePagination=!0,this.tablePaginationSettings.pageIndex=1,this.tablePaginationSettings.pageSize=5,this.tablePaginationSettings.pageSizeOptions=[5,10,15],this.tablePaginationSettings.showFirstLastButtons=!0,this.columnDefinition=[{name:"plan_name",displayName:"Plan Name",disableSorting:!1,isPopup:!0},{name:"lead_name",displayName:"Customer Name",disableSorting:!1},{name:"startdate",displayName:"Start Date",disableSorting:!1,isDate:!0},{name:"enddate",displayName:"End Date",disableSorting:!1,isDate:!0},{name:"maxenddate",displayName:"Max End Date",disableSorting:!1,isDate:!0}]}ngOnInit(){this.initData()}initData(){this.http.get(`/subscription/list/createdAt/-1/${this.tablePaginationSettings.pageIndex}/${this.tablePaginationSettings.pageSize}?`).subscribe(e=>{this.rowData=e.data.list,this.tablePaginationSettings.totalElements=e.data.pagination.total})}onNotifySelected(e){console.log(e,"selected")}isPageChanged(e){this.tablePaginationSettings.pageSize=e.pageSize,this.tablePaginationSettings.pageIndex=e.pageIndex+1,this.initData()}openDialogueModal(e){"add"==e.method?this.dialog.open(f,{width:"60%"}).afterClosed().subscribe(n=>{1==n&&(this.initData(),this.dialog.open(C.e,{data:{title:"New Subscription Added",text:"Congratulations! You've just added a new subscription.",Btn:"Okay",isSuccess:!0,showOnly:!0},width:"35%"}).afterClosed().subscribe(r=>{}))}):"edit"==e.method?this.dialog.open(f,{data:{id:e.id}}).afterClosed().subscribe(o=>{1==o&&(this.initData(),this.dialog.open(C.e,{data:{title:"Subscription Edited",text:"Subscription edited successfully",Btn:"Okay",isSuccess:!0,showOnly:!0},width:"35%"}).afterClosed().subscribe(u=>{}))}):"view"==e.method&&this.dialog.open(f,{data:{id:e.id,isReadonly:!0},width:"60%"})}openPlaninfo(e){this.dialog.open(x.x,{data:{id:e.planid,isInfoscreen:!0},width:"60%"})}openCusInfo(e){this.dialog.open(P.I,{data:{id:e.customer_id,isInfoscreen:!0},width:"60%"})}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(S.h),t.Y36(m.F0),t.Y36(p.uw))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-list"]],decls:2,vars:7,consts:[[3,"rowData","enableCheckbox","allowMultiSelect","tableAddBtn","tableHeading","sqPaginationConfig","sqColumnDefinition","getSelectedRows","PageChanged","openmodal","openplan","openlead"]],template:function(e,a){1&e&&(t._UZ(0,"app-counters"),t.TgZ(1,"app-custom-table",0),t.NdJ("getSelectedRows",function(o){return a.onNotifySelected(o)})("PageChanged",function(o){return a.isPageChanged(o)})("openmodal",function(o){return a.openDialogueModal(o)})("openplan",function(o){return a.openPlaninfo(o)})("openlead",function(o){return a.openCusInfo(o)}),t.qZA()),2&e&&(t.xp6(1),t.Q6J("rowData",a.rowData)("enableCheckbox",!0)("allowMultiSelect",!0)("tableAddBtn","Add subscription")("tableHeading","Subscription")("sqPaginationConfig",a.tablePaginationSettings)("sqColumnDefinition",a.columnDefinition))},dependencies:[N.M,Y.C]}),i})(),canActivate:[D.a]}];let L=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[m.Bz.forChild(J),m.Bz]}),i})();var F=s(1052);let k=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[c.ez,L,F.g,p.Is]}),i})()}}]);